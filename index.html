<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Model Performance Simulator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        /* Custom styles for a more polished look */
        .metric-card {
            @apply bg-white p-5 rounded-xl shadow-md border border-gray-200 flex flex-col justify-between transition-all duration-300 hover:shadow-lg hover:border-blue-400;
        }
        .matrix-container {
            @apply bg-white p-4 rounded-xl shadow-md border border-gray-200;
        }
        .matrix-cell {
            @apply p-4 rounded-lg text-center flex flex-col justify-center items-center;
        }
        .matrix-header {
            @apply font-semibold text-sm text-gray-600;
        }
        .matrix-value {
            @apply text-4xl font-bold;
        }
        .matrix-label {
            @apply text-xs mt-1 font-medium;
        }
        .explanation-card {
            @apply bg-white p-6 rounded-xl shadow-md border border-gray-200 flex flex-col;
        }
        .formula {
            @apply bg-gray-100 p-3 rounded-md text-center text-gray-700 font-mono text-sm mt-4;
        }
    </style>
</head>
<body class="bg-gray-50 p-4 sm:p-6 md:p-8">

    <div class="max-w-6xl mx-auto">
        <!-- Page 1: Simulator -->
        <div id="simulator-page">
            <!-- Header -->
            <div class="flex justify-between items-center mb-10">
                <div class="text-left">
                    <h1 class="text-4xl font-bold text-gray-800">AI Model Performance Simulator</h1>
                    <p class="text-gray-500 mt-2">An interactive tool for understanding medical diagnostic accuracy.</p>
                </div>
                <button id="show-explanation-btn" class="flex-shrink-0 bg-white border border-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-lg hover:bg-gray-100 transition-colors">
                    How It Works
                </button>
            </div>

            <!-- Main Grid -->
            <div class="grid grid-cols-1 lg:grid-cols-5 gap-8">
                
                <!-- Left Column: Inputs -->
                <div class="lg:col-span-2 bg-white p-6 rounded-xl shadow-lg border border-gray-200">
                    <h2 class="text-xl font-bold text-gray-800 mb-4 border-b pb-2">Simulation Parameters</h2>
                    <form id="simulation-form" class="space-y-6">
                        <!-- Population Settings -->
                        <div>
                            <label for="total-patients" class="block text-sm font-medium text-gray-700">Total Patient Population</label>
                            <input type="number" id="total-patients" value="1000" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:ring-blue-500 focus:border-blue-500">
                        </div>
                        <div>
                            <label for="actual-positives" class="block text-sm font-medium text-gray-700">Actual Positive Cases (%)</label>
                            <input type="range" id="actual-positives" min="0" max="100" value="10" class="mt-1 w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer">
                            <span id="actual-positives-value" class="text-sm text-gray-600 font-medium">10%</span>
                        </div>

                        <!-- AI Model Characteristics -->
                        <div class="pt-4 border-t">
                             <h3 class="text-md font-semibold text-gray-700 mb-2">AI Model Accuracy</h3>
                             <div>
                                <label for="sensitivity" class="block text-sm font-medium text-gray-700">Sensitivity (Recall)</label>
                                <input type="range" id="sensitivity" min="0" max="100" value="95" class="mt-1 w-full h-2 bg-red-100 rounded-lg appearance-none cursor-pointer">
                                <span id="sensitivity-value" class="text-sm text-gray-600 font-medium">95%</span>
                                <p class="text-xs text-gray-500 mt-1">Ability to correctly identify positive cases.</p>
                            </div>
                             <div class="mt-4">
                                <label for="specificity" class="block text-sm font-medium text-gray-700">Specificity</label>
                                <input type="range" id="specificity" min="0" max="100" value="98" class="mt-1 w-full h-2 bg-green-100 rounded-lg appearance-none cursor-pointer">
                                <span id="specificity-value" class="text-sm text-gray-600 font-medium">98%</span>
                                <p class="text-xs text-gray-500 mt-1">Ability to correctly identify negative cases.</p>
                            </div>
                        </div>
                        
                        <button type="submit" class="w-full bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500 transition-transform transform hover:scale-105">
                            Run Simulation
                        </button>
                    </form>
                </div>

                <!-- Right Column: Results -->
                <div class="lg:col-span-3">
                    <!-- Confusion Matrix -->
                    <div class="matrix-container">
                        <h2 class="text-xl font-bold text-gray-800 mb-4 px-2">Confusion Matrix</h2>
                        <div class="grid grid-cols-12 gap-2">
                            <div class="col-span-2"></div>
                            <div class="col-span-10 text-center font-semibold text-gray-700 pb-2">Predicted Condition</div>
                            
                            <div class="col-span-2 row-span-2 flex items-center justify-center font-semibold text-gray-700">
                                <span class="-rotate-90">Actual</span>
                            </div>
                            <div class="col-span-1 flex items-center justify-end font-semibold text-gray-500 text-sm">Positive</div>
                            <div class="col-span-4 matrix-cell bg-emerald-50 border border-emerald-200">
                                <span id="tp" class="matrix-value text-emerald-600">0</span>
                                <span class="matrix-label text-emerald-700">True Positive</span>
                            </div>
                            <div class="col-span-4 matrix-cell bg-rose-50 border border-rose-200">
                                <span id="fn" class="matrix-value text-rose-600">0</span>
                                <span class="matrix-label text-rose-700">False Negative</span>
                            </div>
                            <div class="col-span-1"></div>

                            <div class="col-span-1 flex items-center justify-end font-semibold text-gray-500 text-sm">Negative</div>
                            <div class="col-span-4 matrix-cell bg-rose-50 border border-rose-200">
                                <span id="fp" class="matrix-value text-rose-600">0</span>
                                <span class="matrix-label text-rose-700">False Positive</span>
                            </div>
                            <div class="col-span-4 matrix-cell bg-emerald-50 border border-emerald-200">
                                <span id="tn" class="matrix-value text-emerald-600">0</span>
                                <span class="matrix-label text-emerald-700">True Negative</span>
                            </div>
                            <div class="col-span-1"></div>
                        </div>
                    </div>

                    <!-- Performance Metrics -->
                    <div class="mt-8">
                        <h2 class="text-xl font-bold text-gray-800 mb-4">Performance Metrics</h2>
                        <div class="grid grid-cols-1 sm:grid-cols-2 xl:grid-cols-4 gap-6">
                            <div class="metric-card">
                                <div class="flex items-center">
                                    <div class="p-2 bg-blue-100 rounded-lg">
                                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                    </div>
                                    <h3 class="font-bold text-gray-700 ml-3">Accuracy</h3>
                                </div>
                                <p id="accuracy" class="text-4xl font-bold text-gray-800 mt-4">0%</p>
                                <p class="text-xs text-gray-500 mt-1">Overall correctness of the model.</p>
                            </div>
                            <div class="metric-card">
                                <div class="flex items-center">
                                    <div class="p-2 bg-green-100 rounded-lg">
                                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6l3 1m0 0l-3 9a5.002 5.002 0 006.001 0M6 7l3 9M6 7l6-2m6 2l3-1m-3 1l-3 9a5.002 5.002 0 006.001 0M18 7l3 9m-3-9l-6-2m0-2v2m0 16V5m0 16H9m3 0h3"></path></svg>
                                    </div>
                                    <h3 class="font-bold text-gray-700 ml-3">Precision</h3>
                                </div>
                                <p id="precision" class="text-4xl font-bold text-gray-800 mt-4">0%</p>
                                <p class="text-xs text-gray-500 mt-1">Of predicted positives, how many are true?</p>
                            </div>
                            <div class="metric-card">
                                <div class="flex items-center">
                                    <div class="p-2 bg-red-100 rounded-lg">
                                        <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg>
                                    </div>
                                    <h3 class="font-bold text-gray-700 ml-3">Recall</h3>
                                </div>
                                <p id="recall" class="text-4xl font-bold text-gray-800 mt-4">0%</p>
                                <p class="text-xs text-gray-500 mt-1">Of actual positives, how many were found?</p>
                            </div>
                            <div class="metric-card">
                                <div class="flex items-center">
                                    <div class="p-2 bg-purple-100 rounded-lg">
                                        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path></svg>
                                    </div>
                                    <h3 class="font-bold text-gray-700 ml-3">F1 Score</h3>
                                </div>
                                <p id="f1-score" class="text-4xl font-bold text-gray-800 mt-4">0%</p>
                                <p class="text-xs text-gray-500 mt-1">Harmonic mean of Precision and Recall.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Page 2: Explanation -->
        <div id="explanation-page" class="hidden">
            <!-- Header -->
            <div class="flex justify-between items-center mb-10">
                 <button id="show-simulator-btn" class="flex-shrink-0 bg-white border border-gray-300 text-gray-700 font-semibold py-2 px-4 rounded-lg hover:bg-gray-100 transition-colors">
                    &larr; Back to Simulator
                </button>
                <div class="text-center flex-grow">
                    <h1 class="text-4xl font-bold text-gray-800">How The Simulator Works</h1>
                    <p class="text-gray-500 mt-2">Understanding the journey from parameters to performance.</p>
                </div>
                <div class="w-40"></div> <!-- Spacer to balance the button -->
            </div>

            <!-- Explanation Content -->
            <div class="space-y-8">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8 text-center">
                    <!-- Step 1 -->
                    <div class="explanation-card">
                        <div class="flex justify-center mb-4">
                            <span class="flex items-center justify-center w-16 h-16 bg-blue-100 text-blue-600 rounded-full text-2xl font-bold">1</span>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">Set Parameters</h3>
                        <p class="text-gray-600 mt-2">You define the scenario: the size of the patient group, the percentage of sick patients (prevalence), and the AI model's core abilities (Sensitivity and Specificity).</p>
                    </div>
                    <!-- Step 2 -->
                    <div class="explanation-card">
                        <div class="flex justify-center mb-4">
                            <span class="flex items-center justify-center w-16 h-16 bg-blue-100 text-blue-600 rounded-full text-2xl font-bold">2</span>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">Run Simulation</h3>
                        <p class="text-gray-600 mt-2">The simulator calculates the four outcomes of the Confusion Matrix by applying the AI's sensitivity and specificity to the patient population you defined.</p>
                    </div>
                    <!-- Step 3 -->
                    <div class="explanation-card">
                        <div class="flex justify-center mb-4">
                            <span class="flex items-center justify-center w-16 h-16 bg-blue-100 text-blue-600 rounded-full text-2xl font-bold">3</span>
                        </div>
                        <h3 class="text-xl font-bold text-gray-800">Analyze Results</h3>
                        <p class="text-gray-600 mt-2">Using the Confusion Matrix results, the simulator calculates the final performance metrics to evaluate the model.</p>
                    </div>
                </div>

                <!-- Key Terms -->
                <div>
                    <h2 class="text-2xl font-bold text-gray-800 mb-4 text-center">Key Terms Explained</h2>
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div class="explanation-card">
                            <h4 class="font-bold text-lg text-gray-800">Accuracy</h4>
                            <p class="text-gray-600 mt-1 flex-grow">The percentage of all predictions that the model got right. A good general measure, but can be misleading with unbalanced data.</p>
                            <div class="formula">(TP + TN) / (TP + TN + FP + FN)</div>
                        </div>
                        <div class="explanation-card">
                            <h4 class="font-bold text-lg text-gray-800">Precision</h4>
                            <p class="text-gray-600 mt-1 flex-grow">Of all the times the model predicted "Positive," what percentage were correct? High precision means few false alarms.</p>
                            <div class="formula">TP / (TP + FP)</div>
                        </div>
                        <div class="explanation-card">
                            <h4 class="font-bold text-lg text-gray-800">Recall (Sensitivity)</h4>
                            <p class="text-gray-600 mt-1 flex-grow">Of all the patients who were actually sick, what percentage did the model find? High recall means few missed cases.</p>
                            <div class="formula">TP / (TP + FN)</div>
                        </div>
                         <div class="explanation-card">
                            <h4 class="font-bold text-lg text-gray-800">F1 Score</h4>
                            <p class="text-gray-600 mt-1 flex-grow">The harmonic mean of Precision and Recall. It provides a single score that represents a model's balanced performance.</p>
                            <div class="formula">2 * (Precision * Recall) / (Precision + Recall)</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Page Navigation ---
        const simulatorPage = document.getElementById('simulator-page');
        const explanationPage = document.getElementById('explanation-page');
        const showExplanationBtn = document.getElementById('show-explanation-btn');
        const showSimulatorBtn = document.getElementById('show-simulator-btn');

        showExplanationBtn.addEventListener('click', () => {
            simulatorPage.classList.add('hidden');
            explanationPage.classList.remove('hidden');
        });

        showSimulatorBtn.addEventListener('click', () => {
            explanationPage.classList.add('hidden');
            simulatorPage.classList.remove('hidden');
        });


        // --- Simulator Logic ---
        const form = document.getElementById('simulation-form');
        const totalPatientsInput = document.getElementById('total-patients');
        const actualPositivesSlider = document.getElementById('actual-positives');
        const sensitivitySlider = document.getElementById('sensitivity');
        const specificitySlider = document.getElementById('specificity');

        const actualPositivesValue = document.getElementById('actual-positives-value');
        const sensitivityValue = document.getElementById('sensitivity-value');
        const specificityValue = document.getElementById('specificity-value');

        const tpCell = document.getElementById('tp');
        const fnCell = document.getElementById('fn');
        const fpCell = document.getElementById('fp');
        const tnCell = document.getElementById('tn');

        const accuracyDisplay = document.getElementById('accuracy');
        const precisionDisplay = document.getElementById('precision');
        const recallDisplay = document.getElementById('recall');
        const f1Display = document.getElementById('f1-score');

        function updateSliderValue(slider, display) {
            display.textContent = `${slider.value}%`;
        }

        actualPositivesSlider.addEventListener('input', () => updateSliderValue(actualPositivesSlider, actualPositivesValue));
        sensitivitySlider.addEventListener('input', () => updateSliderValue(sensitivitySlider, sensitivityValue));
        specificitySlider.addEventListener('input', () => updateSliderValue(specificitySlider, specificityValue));

        form.addEventListener('submit', function(event) {
            event.preventDefault();
            runSimulation();
        });
        
        document.addEventListener('DOMContentLoaded', runSimulation);

        function runSimulation() {
            const totalPatients = parseInt(totalPatientsInput.value);
            const positiveRate = parseInt(actualPositivesSlider.value) / 100;
            const sensitivity = parseInt(sensitivitySlider.value) / 100;
            const specificity = parseInt(specificitySlider.value) / 100;

            if (isNaN(totalPatients) || totalPatients <= 0) {
                console.error("Please enter a valid number of patients.");
                totalPatientsInput.value = 1000;
                return;
            }

            const actualPositives = Math.round(totalPatients * positiveRate);
            const actualNegatives = totalPatients - actualPositives;

            const tp = Math.round(actualPositives * sensitivity);
            const fn = actualPositives - tp;
            const tn = Math.round(actualNegatives * specificity);
            const fp = actualNegatives - tn;

            tpCell.textContent = tp;
            fnCell.textContent = fn;
            fpCell.textContent = fp;
            tnCell.textContent = tn;

            const total = totalPatients;
            const predictedPositives = tp + fp;

            const accuracy = total > 0 ? ((tp + tn) / total) : 0;
            accuracyDisplay.textContent = `${(accuracy * 100).toFixed(1)}%`;

            const precision = predictedPositives > 0 ? (tp / predictedPositives) : 0;
            precisionDisplay.textContent = `${(precision * 100).toFixed(1)}%`;

            const recall = actualPositives > 0 ? (tp / actualPositives) : 0;
            recallDisplay.textContent = `${(recall * 100).toFixed(1)}%`;

            const f1 = (precision + recall) > 0 ? 2 * (precision * recall) / (precision + recall) : 0;
            f1Display.textContent = `${(f1 * 100).toFixed(1)}%`;
        }
    </script>
</body>
</html>
